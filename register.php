<?php require('search.php'); ?><!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>情報連携実習III デモサイト vacant</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="情報連携実習IIIで作成"><meta name="keywords" content="レンタルオフィス,シェアオフィス,コワーキング,INIAD,坂村健"><link rel="stylesheet" href="css/style.css"><link rel="stylesheet" href="css/slide.css"><link rel="icon" href="favicon.ico" id="favicon"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><style type="text/css"></style><script src="https://kit.fontawesome.com/258022ddb4.js" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> <script type="text/javascript" src="js/openclose.js"></script> <script type="text/javascript" src="js/fixmenu_pagetop.js"></script> <script type="text/javascript" src="js/myscript.js"></script> <!-- Bootstrap CSS --> <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">--> <!-- Bootstrap Javascript(jQuery含む) --> <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>--></head><body class="c2"><div id="container"><?php require('header.php'); ?><!--スライドショー--> <!--  <aside id="mainimg"> <img src="images/1.jpg" alt="" class="slide0"> <img src="images/1.jpg" alt="" class="slide1"> <img src="images/2.jpg" alt="" class="slide2"> <img src="images/3.jpg" alt="" class="slide3"> </aside>--><div id="contents">	<div id="contents-in">		<div id="main">			<section id="new">				<h2>物件登録フォーム</h2>				<div style="text-align: center">					<?php					// タイムゾーン設定					date_default_timezone_set( 'Asia/Tokyo' );					// 書き込み日時を取得					$current_date = date( "Y-m-d H:i:s" );					$pdo = null;					$host = 'localhost';					$username = 'root';					$passwd = 'root';					$dbname = 'vacant';					$tablename = 'property';					$options = array(						// SQL実行失敗時に例外をスルー						PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,						// デフォルトフェッチモードを連想配列形式に設定						PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,						// バッファードクエリを使う（一度に結果セットを全て取得し、サーバー負荷を軽減）						// SELECTで得た結果に対してもrowCountメソッドを使えるようにする						PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true,					);					//	$pdo = new PDO( 'mysql:charset=UTF8;dbname=' . $dbname . ';host=' . $host, $username, $passwd, $option );					$conn = mysqli_connect( $host, $username, $passwd, $dbname );					if ( $conn == false ) {						die( "エラー: 接続できませんでした。" . mysqli_connect_error() );					}					$applicant_name = $_REQUEST[ 'applicant_name' ];					$property_name = $_REQUEST[ 'property_name' ];					$station = $_REQUEST[ 'station' ];					$zip = $_REQUEST[ 'zip' ];					$state = $_REQUEST[ 'state' ];					$city = $_REQUEST[ 'city' ];					$street = $_REQUEST[ 'street' ];					$email = $_REQUEST[ 'email' ];					$phone = $_REQUEST[ 'phone' ];					$description = $_REQUEST[ 'description' ];					$post_date = $current_date;					$dbh = new PDO( 'mysql:dbname=vacant;host=localhost;charset=utf8', 'root', 'root', $options );					$query = $dbh->prepare( 'SELECT * FROM property WHERE property_name = :property_name limit 1' );					$query->execute( array( ':property_name' => $property_name ) );					$result = $query->fetch();					if ( $result > 0 ) {						echo 'この物件は既に登録済みです。';					} else {						$sql = "INSERT INTO $tablename VALUES (null, N'$applicant_name',N'$property_name',N'$station',N'$zip',N'$state',N'$city',N'$street',N'$email',N'$phone',N'$description',N'$post_date')";						if ( mysqli_query( $conn, $sql ) ) {							echo "データベースに正常に登録されました。";						} else {							echo "エラー: $sql. " . mysqli_error( $conn );						}					}					mysqli_close( $conn )					?>				</div>								<!--					<p class="r">&raquo;&nbsp;<a href="#">過去ログ</a></p>--> 			</section>			<br>			<section>				<table class="ta1">					<tr>						<th colspan="2" class="tamidashi" style="text-align: center">登録内容</th>					</tr>					<tr>						<th>申込者名</th>						<td><?php echo($applicant_name) ?></td>					</tr>					<tr>						<th>物件名</th>						<td><?php echo($property_name) ?></td>					</tr>					<tr>						<th>最寄駅</th>						<td><?php echo($station) ?></td>					</tr>					<tr>						<th>住所</th>						<td><?php echo('〒'. $zip. '  '. $state. $city. $street) ?></td>					</tr>					<tr>						<th>メールアドレス</th>						<td><?php echo($email) ?></td>					</tr>					<tr>						<th>電話番号</th>						<td><?php echo($phone) ?></td>					</tr>					<tr>						<th>備考</th>						<td><?php echo($description) ?></td>					</tr>				</table>				<div style="text-align: center" class="c">					<button type="button" onclick="history.back()" class="btn">戻る</button>				</div>				<br>			</section>		</div>		<!--/#main-->				<div id="sub">			<div class="box1">				<h2>おすすめ物件情報</h2>				<?php				try {					//test@localhostでblogに接続					$pdo = new PDO( 'mysql:dbname=vacant;host=localhost;charset=utf8', 'root', 'root' );				} catch ( PDOException $error ) {					//エラーの場合はエラーメッセージを吐き出す					exit( "データベースに接続できませんでした。<br>" . $error->getMessage() );				}				//prepareでSQLを準備				//					$id = 34;				//					echo $id;				$select = $pdo->prepare( "SELECT * FROM property LIMIT 5 OFFSET 5" );				$select->execute(); //準備したSQLを実行。PDO Statementクラスのオブジェクトが渡される。(SQLの結果も保持する)				//PDO Statementのfetchメッソドを利用して、結果を一行ずつ取得。データがなくなるとFALSEを返す。				while ( $row = $select->fetch( PDO::FETCH_ASSOC ) ) {					$title = $row[ 'property_name' ]; //タイトルを取得					$file_path = $row[ 'id' ]; //ファイルパスを取得					$station = $row[ 'station' ];					$zip = $row[ 'zip' ];					$state = $row[ 'state' ];					$city = $row[ 'city' ];					$street = $row[ 'street' ];					$email = $row[ 'email' ];					$phone = $row[ 'phone' ];					$description = $row[ 'description' ];					$date = $row[ 'post_date' ];					echo "<div class='list'> <a href='./property.php?id=$file_path'>						<figure><img src='images/iniad.jpg' alt=''></figure>						<h4>$title<span class='newicon'>NEW</span></h4>						<p>所在地：$state $city<br>							価格：XXXXX円</p>						</a> </div>";				}				?>			</div>						<!--/#sub--> 		</div>		<!--/#contents-in--> 			</div>	<!--/#contents--> 	</div><!--/#container--><?php require('footer.php'); ?></body></html>